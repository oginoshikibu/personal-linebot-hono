# 家庭用食事管理LINEボット 要件定義書

## 1. 概要
家庭での食事予定を管理するためのLINEボットです。家族メンバーが各食事に参加するかどうか、食事の準備方法などを管理し、定期的に確認メッセージを送信します。

## 2. 対象ユーザー
- AliceとBobの2名のみ（固定）
- 登録済みLINE IDのみが利用可能
- 未登録のIDからのメッセージには応答しない
- ユーザー間に権限の差はなし

## 3. 機能要件

### 3.1 主要機能

#### 統一的な食事計画管理
- 昼食・夕食を統一的に管理
- 準備担当者と参加状況を分離
- 昼食: Bob固定担当
- 夕食: Bobが担当者選択（Alice or Bob）

#### 参加状況管理
- 各メンバーの参加状況: 参加/不参加/未定（Bobのみ）
- 担当者は必ず参加状態
- 担当者辞退時は全員自動不参加

#### 状態遷移管理
- 昼食: 4つの状態（Bob担当を基本とした状態遷移）
- 夕食: 5つの状態（Alice/Bob担当選択による状態遷移）

#### 定期通知
- 夜22時: 翌日の昼食・夕食の予定確認
- 朝7時: 当日の予定再確認

#### 予定変更機能
- リッチメニューから変更操作を選択
- 変更時は他のメンバーに通知

### 3.2 オプション機能
- 月間の食事統計情報
- 自炊回数、外食回数などのレポート

## 4. 非機能要件

### 4.1 セキュリティ
- 登録済みLINE IDのみアクセス可能
- 環境変数による認証情報の管理
- Zodによる入力値バリデーション

### 4.2 パフォーマンス
- 応答時間: 3秒以内
- 24時間稼働

### 4.3 データ管理
- 開発環境: SQLiteによるローカルデータストレージ
- 本番環境: MySQLによるデータストレージ
- Prisma ORMによる型安全なデータベースアクセス
- バックアップ: 特に要件なし（データ消失は許容）

## 5. ユーザーインターフェース

### リッチメニュー構成
- 今日の予定
- 明日の予定
- 今週の予定
- 今後の予定

### 実装済み機能
- カレンダー表示機能
- Flexメッセージによるリッチな表示
- ポストバック処理による操作
- コマンドライン形式の操作も対応

### 操作フロー
1. 予定確認・編集
   - 日付選択
   - 食事タイプ選択 (昼食/夕食)
   - 参加有無選択
   - 担当者選択（夕食初回のみ、Bobが選択）
   - 確認・保存

2. 状態遷移
   - 参加状況変更による自動状態更新
   - 担当者辞退による全員不参加遷移
   - ビジネスルール検証とエラーハンドリング

## 6. 通知メッセージ例

### 夜の確認メッセージ
```
【明日の食事予定確認】
◆ 昼食
Alice: 不参加
Bob: 参加
準備: Bobが作る

◆ 夕食
Alice: 参加
Bob: 参加
準備: Aliceが作る

予定を変更する場合はメニューから「予定変更」を選択してください。
```

### 朝の確認メッセージ
```
【本日の食事予定】
◆ 昼食
Alice: 不参加
Bob: 参加
準備: Bobが作る

◆ 夕食
Alice: 参加
Bob: 参加
準備: Aliceが作る

予定を変更する場合はメニューから「予定変更」を選択してください。
```

## 7. 制約事項

- 固定ユーザー: AliceとBobのみ
- 食事タイプ: 昼食・夕食のみ
- 昼食制約: Bob固定担当、変更不可
- 夕食制約: Bobが担当者選択、一度決定後は変更不可
- 担当者制約: 担当者は必ず参加状態
- 辞退ルール: 担当者辞退時は全員自動不参加
- 当日・翌日の予定変更時のみ他メンバーに通知

## 8. 関連ドキュメント

- [アーキテクチャ設計](domain_model.md) - 詳細な技術仕様
- [データベース設計](er_diagram.md) - データモデルとER図
- [ユーザーフロー](user_flow.md) - 操作フローの詳細 